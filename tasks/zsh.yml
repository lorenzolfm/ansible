- name: Install zsh
  become: true
  apt:
    name: zsh
  tags: 
    - zsh
    - essentials

- name: Change shell to zsh
  become: true
  shell: chsh -s $(which zsh)
  tags: 
    - zsh
    - essentials

- name: Install Oh-My-Zsh
  shell: sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
  tags: 
    - zsh
    - essentials

- name: Check if zshrc.pre-oh-my-zsh exists
  stat:
    path: "{{ home }}/.zshrc.pre-oh-my-zsh"
  register: old_zshrc_exists
  tags: 
    - zsh
    - essentials

- name: Replace .zshrc with .zshrc.pre-oh-my-zsh
  shell: "rm -rf {{ home }}/.zshrc && mv {{ home }}/.zshrc.pre-oh-my-zsh {{ home }}/.zshrc"
  when: old_zshrc_exists.stat.exists
  tags: 
    - zsh
    - essentials

- name: Install Spaceship theme
  git:
    repo: https://github.com/spaceship-prompt/spaceship-prompt.git
    dest: "{{ home }}/.oh-my-zsh/custom/themes/spaceship-prompt"
  tags: 
    - zsh
    - essentials

- name: Change permissions for Spaceship theme folder
  file:
    path: "{{ home }}/.oh-my-zsh/custom/themes/spaceship-prompt"
    mode: 0775
  tags: 
    - zsh
    - essentials

- name: Symlink spaceship.zsh-theme to oh-my-zsh custom themes directory
  shell: "ln -s {{ home }}/.oh-my-zsh/custom/themes/spaceship-prompt/spaceship.zsh-theme {{ home }}/.oh-my-zsh/custom/themes/spaceship.zsh-theme"
  tags: 
    - zsh
    - essentials

- name: Install zsh-z plugin
  git:
    repo: https://github.com/agkozak/zsh-z.git
    dest: "{{ home }}/.oh-my-zsh/plugins/zsh-z" 
  tags: 
    - zsh
    - essentials

- name: Install zsh-autosuggestions
  git:
    repo: https://github.com/zsh-users/zsh-autosuggestions.git
    dest: "{{ home }}/.oh-my-zsh/custom/plugins/zsh-autosuggestions"
  tags: 
    - zsh
    - essentials

- name: Change permissions for zsh-autosuggestions
  file:
    path: "{{ home }}/.oh-my-zsh/custom/plugins/zsh-autosuggestions"
    mode: 0775
  tags: 
    - zsh
    - essentials
